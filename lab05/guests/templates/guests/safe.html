{% extends "base.html" %}
{% block title %}Безопасная форма{% endblock %}
{% block content %}
<section class="card">
  <h1>Безопасная гостевая книга</h1>
  <p>Здесь включена валидация данных и экранирование вывода. Это рабочая версия после внедрения требований лабораторной №5.</p>
  <form method="post" class="form-grid" novalidate>
    {% csrf_token %}
    <div class="form-field">
      <label for="user-input">Имя</label>
      <input id="user-input" name="user" value="{{ request.POST.user|default:'' }}" />
      {% if errors.user %}
        <div class="form-errors">{{ errors.user }}</div>
      {% endif %}
    </div>
    <div class="form-field">
      <label for="email-input">E-mail</label>
      <input id="email-input" name="e_mail" value="{{ request.POST.e_mail|default:'' }}" />
      {% if errors.e_mail %}
        <div class="form-errors">{{ errors.e_mail }}</div>
      {% endif %}
    </div>
    <div class="form-field">
      <label for="message-input">Сообщение (HTML экранируется)</label>
      <textarea id="message-input" rows="4" name="text_message">{{ request.POST.text_message|default:'' }}</textarea>
      {% if errors.text_message %}
        <div class="form-errors">{{ errors.text_message }}</div>
      {% endif %}
    </div>
    <button type="submit" class="button">Отправить</button>
  </form>
</section>

<section class="card">
  <h2>Последние сообщения</h2>
  {% for g in entries %}
    <div class="msg">
      <div class="meta">{{ g.user }} · {{ g.e_mail }} · {{ g.data_time_message|date:"d.m.Y H:i" }}</div>
      <div class="body">{{ g.text_message }}</div>
    </div>
  {% empty %}
    <p>Пока нет записей.</p>
  {% endfor %}
</section>
{% endblock %}
